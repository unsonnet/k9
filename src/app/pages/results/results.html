<div class="results">
  <div class="results__sidebar">
    <app-results-reference [images]="reference().images" />

    <div class="results__thresholds">
      <app-results-thresholds
        (applyFilter)="handleFilter($event)"
        (exportResults)="handleExport()"
        [exportEnabled]="exportEnabled()"
      />
    </div>
  </div>

  <div class="results__main">
    <div class="results__header">
      <div class="results__stat">
        Total:
        <span class="results__count" [title]="sortedProducts().length">
          {{ sortedProducts().length > 999 ? '999+' : sortedProducts().length }}
        </span>
      </div>

      <div class="results__stat">
        Selected:
        <span class="results__count" [title]="starredCount()">
          {{ starredCount() > 999 ? '999+' : starredCount() }}
        </span>
      </div>

      <div class="results__sort">
        <label for="sort-select">Order by:</label>
        <select
          [ngModel]="orderBy()"
          (ngModelChange)="orderBy.set($event)"
          id="sort-select"
        >
          <option value="score">Score</option>
          <option value="name">Name</option>
          <option value="starred">Starred</option>
        </select>
      </div>
    </div>

    <div class="results__grid">
      <app-results-grid
        [products]="sortedProducts()"
        (productClicked)="openProduct($event)"
        (starToggled)="toggleStar($event)"
      />
    </div>
  </div>

  @if (hasOverlay) {
  <div class="results__overlay" (click)="closeOverlay()">
    @if (activeProduct()) {
    <app-product
      class="results__overlay-content results__overlay-content--product"
      [product]="activeProduct()!"
      [reference]="reference()"
      (starToggled)="toggleStar(activeProduct()!)"
      (click)="$event.stopPropagation()"
    />
    } @else if (loadingMessage()) {
    <div
      class="results__overlay-content results__overlay-content--loading"
      (click)="$event.stopPropagation()"
    >
      <h2>{{ loadingMessage() }}</h2>
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>
    } @else if (exportUrl()) {
    <div
      class="results__overlay-content results__overlay-content--loading"
      (click)="$event.stopPropagation()"
    >
      <a
        [href]="exportUrl()"
        download="exported_products.zip"
        mat-raised-button
        color="primary"
        class="results__download-button"
      >
        Download Report
      </a>
    </div>
    } @else if (overlayError()) {
    <div
      class="results__overlay-content results__overlay-content--error"
      (click)="$event.stopPropagation()"
    >
      <h2>{{ overlayError() }}</h2>
    </div>
    }
  </div>
  }
</div>
