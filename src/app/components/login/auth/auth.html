@if (resetMode()) {
  <h1 class="title">Reset Password</h1>
} @else {
  <h1 class="title">Log In</h1>
}

<form class="auth-form" [formGroup]="form" (ngSubmit)="onSubmit()">
  @if (!resetMode()) {
    <mat-form-field>
      <mat-label>Username</mat-label>
      <input matInput formControlName="username" />
      @if (
        form.get('username')?.touched &&
        form.get('username')?.hasError('required')
      ) {
        <mat-error>Username is required</mat-error>
      }
    </mat-form-field>

    <mat-form-field>
      <mat-label>Password</mat-label>
      <input matInput type="password" formControlName="password" />
      @if (
        form.get('password')?.touched &&
        form.get('password')?.hasError('required')
      ) {
        <mat-error>Password is required</mat-error>
      }
    </mat-form-field>
  }

  @if (statusMessage()) {
    <div
      class="auth-form__status"
      [ngClass]="{
        'auth-form__status--success': statusMessage()?.type === 'success',
        'auth-form__status--error': statusMessage()?.type === 'error'
      }"
    >
      {{ statusMessage()?.text }}
    </div>
  }

  @if (!resetMode()) {
    <button
      class="auth-form__submit"
      mat-raised-button
      color="primary"
      type="submit"
      [disabled]="loading()"
    >
      @if (loading()) {
        <mat-progress-spinner
          diameter="20"
          mode="indeterminate"
          class="auth-form__spinner"
        />
      } @else {
        Login
      }
    </button>
  }

  @if (resetMode()) {
    <mat-form-field>
      <mat-label>New Password</mat-label>
      <input matInput type="password" [formControl]="newPassword" />
    </mat-form-field>

    <ul class="auth-form__requirements">
      <li [class.valid]="passwordValid().length">
        Must be at least 8 characters
      </li>
      <li [class.valid]="passwordValid().upper">
        Must contain an uppercase letter
      </li>
      <li [class.valid]="passwordValid().lower">
        Must contain a lowercase letter
      </li>
      <li [class.valid]="passwordValid().digit">
        Must contain a number
      </li>
      <li [class.valid]="passwordValid().special">
        Must contain a special character
      </li>
    </ul>

    <button
      class="auth-form__submit"
      mat-raised-button
      color="primary"
      type="button"
      (click)="submitReset()"
      [disabled]="!allValid() || loading()"
    >
      @if (loading()) {
        <mat-progress-spinner
          diameter="20"
          mode="indeterminate"
          class="auth-form__spinner"
        />
      } @else {
        Reset
      }
    </button>
  }
</form>
