(function(){"use strict";const o={useCache:!0,imageType:"jpeg"};let r,d={};function l(t,a,e,n){const f=t.dataset.jxlSrc;if(a instanceof Blob)u(t,URL.createObjectURL(a),e,n);else if("OffscreenCanvas"in window){const c=new OffscreenCanvas(a.width,a.height);d[f].postMessage({canvas:c,imgData:a,imageType:o.imageType},[c]),d[f].addEventListener("message",s=>{s.data.url&&s.data.blob&&(u(t,s.data.url,e,n),o.useCache&&r&&r.put(f,new Response(s.data.blob)))})}else{const c=document.createElement("canvas");c.width=a.width,c.height=a.height,c.getContext("2d").putImageData(a,0,0),c.toBlob(s=>{u(t,URL.createObjectURL(s),e,n),o.useCache&&r&&r.put(f,new Response(s))},"image/"+o.imageType)}}function u(t,a,e,n){e?t.style.backgroundImage='url("'+a+'")':n?(t.srcset=a,t.type="image/"+o.imageType):t.src=a}async function i(t,a,e){const n=t.dataset.jxlSrc=a?getComputedStyle(t).backgroundImage.slice(5,-2):e?t.srcset:t.currentSrc;if(!a&&!e&&(t.srcset="",t.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),o.useCache){try{r=r||await caches.open("jxl")}catch{}const s=r&&await r.match(n);if(s){const h=await s.blob();requestAnimationFrame(()=>l(t,h,a,e));return}}const c=await(await fetch(n)).arrayBuffer();d[n]=new Worker("jxl_dec.js"),d[n].postMessage({jxlSrc:n,image:c}),d[n].addEventListener("message",s=>s.data.imgData&&requestAnimationFrame(()=>l(t,s.data.imgData,a,e)))}new MutationObserver(t=>t.forEach(a=>a.addedNodes.forEach(e=>{e instanceof HTMLImageElement&&e.src.endsWith(".jxl")?e.onerror=()=>i(e,!1,!1):e instanceof HTMLSourceElement&&e.srcset.endsWith(".jxl")?i(e,!1,!0):e instanceof Element&&getComputedStyle(e).backgroundImage.endsWith('.jxl")')&&i(e,!0,!1)}))).observe(document.documentElement,{subtree:!0,childList:!0})})();
